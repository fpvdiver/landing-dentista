<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRM Odonto – Documentos</title>

  <!-- CSS base -->
  <link rel="stylesheet" href="../css/bootstrap.css" />
  <link rel="stylesheet" href="css/crm.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Sidebar helper (mesmo arquivo usado nas outras páginas) -->
  <script defer src="js/sidebar.js"></script>

  <style>
    /* Ajustes leves específicos da página */
    .doc-filters{ display:flex; gap:10px; padding:12px 4px; overflow:auto; }
    .doc-chip{ border:1px solid var(--ring); background:#fff; border-radius:999px; padding:6px 12px; cursor:pointer; white-space:nowrap; }
    .doc-chip.active{ border-color:var(--primary); color:#0369a1; background:#eff6ff; }
    .doc-grid{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:16px; }
    .doc-card{ display:flex; gap:12px; align-items:flex-start; }
    .doc-icon{ width:42px; height:42px; display:grid; place-items:center; border-radius:12px; background:var(--chip); color:#0f172a; }
    .doc-title{ font-weight:700; }
    .doc-meta{ font-size:12px; color:var(--muted); }
    @media (max-width: 1200px){ .doc-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 768px){  .doc-grid{ grid-template-columns: 1fr; } }
  </style>
</head>
<body data-page="documentos">

<div class="crm-app">
  <!-- ===== Sidebar ===== -->
  <aside class="crm-sidebar" id="crm-sidebar">
    <div class="crm-brand">
      <span class="logo"></span>
      <div>
        <div style="font-weight:800; font-size:18px;">OdontoCRM</div>
        <div style="color:var(--muted); font-size:12px;">Clínica Elen Nogata</div>
      </div>
    </div>

    <nav class="crm-nav">
      <a href="inicio.html" data-nav="inicio"><i class="fa-solid fa-grid-2"></i> Início</a>
      <a href="agenda.html" data-nav="agenda"><i class="fa-regular fa-calendar-days"></i> Agenda</a>
      <a href="pacientes.html" data-nav="pacientes"><i class="fa-regular fa-user"></i> Pacientes</a>
      <a href="orcamentos.html" data-nav="orcamentos"><i class="fa-regular fa-folder-open"></i> Orçamentos</a>
      <a href="procedimentos.html" data-nav="procedimentos"><i class="fa-solid fa-tooth"></i> Procedimentos</a>
      <a href="campanhas.html" data-nav="campanhas"><i class="fa-regular fa-paper-plane"></i> Campanhas</a>
      <a href="documentos.html" class="active"><i class="fa-regular fa-file-lines"></i> Documentos</a>
      <a href="configuracoes.html" data-nav="configuracoes"><i class="fa-solid fa-gear"></i> Configurações</a>
    </nav>

    <div class="crm-footer">
      <div>Conectado como <strong>admin@clinica</strong></div>
      <div>v0.1</div>
    </div>
  </aside>

  <!-- Overlay mobile -->
  <div class="crm-overlay" id="crm-overlay"></div>

  <!-- ===== Main ===== -->
  <main class="crm-main">
    <!-- Botão hambúrguer (mobile) -->
    <button class="crm-burger" id="btn-sidebar" aria-label="Abrir menu">
      <i class="fa-solid fa-bars"></i>
    </button>

    <!-- HERO -->
    <section class="crm-hero">
      <h1 class="text-center mb-3">Documentos</h1>

      <div class="crm-search" style="max-width:840px">
        <i class="fa-solid fa-magnifying-glass" style="color:var(--muted)"></i>
        <input id="doc-search" placeholder="Buscar documento, termo, especialidade..." />
        <button id="btn-search" class="btn btn-sm btn-outline-secondary btn-pill">Buscar</button>
        <a id="btn-new" class="btn btn-sm btn-primary btn-pill ml-2">
          <i class="fa-regular fa-paper-plane mr-1"></i> Novo documento
        </a>
      </div>
      <div class="search-hint">Dica: pesquise por “anamnese”, “consentimento”, “implante”, “LGPD”...</div>
    </section>

    <!-- CONTEÚDO -->
    <section class="crm-content">
      <!-- filtros/abas -->
      <div class="doc-filters">
        <span class="doc-chip active" data-filter="tudo">Tudo</span>
        <span class="doc-chip" data-filter="anamnese">Anamnese</span>
        <span class="doc-chip" data-filter="consentimento">Consentimentos</span>
        <span class="doc-chip" data-filter="administrativo">Administrativo</span>
        <span class="doc-chip" data-filter="ortodontia">Ortodontia</span>
        <span class="doc-chip" data-filter="implante">Implantodontia</span>
        <span class="doc-chip" data-filter="cirurgia">Cirurgia</span>
        <span class="doc-chip" data-filter="endodontia">Endodontia</span>
        <span class="doc-chip" data-filter="periodontia">Periodontia</span>
        <span class="doc-chip" data-filter="estetica">Estética</span>
        <span class="doc-chip" data-filter="radiologia">Radiologia</span>
      </div>

      <div class="doc-grid" id="doc-grid">
        <!-- cards renderizados via JS -->
      </div>
    </section>
  </main>
</div>

<!-- ===== MODAL: novo documento ===== -->
<div class="modal fade" id="md-new-doc" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header themed">
        <h5 class="modal-title"><i class="fa-regular fa-file-lines mr-2"></i>Novo documento</h5>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <form id="form-new-doc">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Paciente</label>
              <input class="form-control" list="dl-pacientes" id="nd-paciente" placeholder="Digite para buscar..." required>
              <datalist id="dl-pacientes">
                <option value="Amanda">
                <option value="Bruna">
                <option value="Carlos">
                <option value="Emiliane">
              </datalist>
            </div>
            <div class="form-group col-md-6">
              <label>Modelo</label>
              <select class="form-control" id="nd-modelo" required></select>
            </div>
          </div>
          <div class="form-group">
            <label>Observações (opcional)</label>
            <input class="form-control" id="nd-notes" placeholder="Campos adicionais, instruções, etc.">
          </div>
          <div class="alert alert-light mb-0">
            Ao confirmar, abriremos o preenchimento do modelo escolhido. Você poderá salvar em PDF, imprimir ou compartilhar um link.
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary btn-pill" data-dismiss="modal">Cancelar</button>
          <button class="btn btn-primary btn-pill" type="submit">
            <i class="fa-regular fa-pen-to-square mr-1"></i> Iniciar preenchimento
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ===== SCRIPTS ===== -->
<script src="../js/jquery-3.4.1.min.js"></script>
<script src="../js/bootstrap.js"></script>

<script>
/** ==========================================================
 *  Base de modelos (essenciais em odontologia)
 *  tag: usada para filtro
 *  cat: categoria textual (exibição)
 *  ========================================================== */
const MODELOS = [
  // Anamnese / Clínica
  { id:'anamnese-geral', title:'Anamnese Odontológica (Wizard)', cat:'Anamnese', tag:'anamnese', icon:'fa-clipboard-question', updated:'2025-07-10', href:'anamnese.html' },
  { id:'ficha-clinica', title:'Ficha Clínica Odontológica', cat:'Clínica', tag:'anamnese', icon:'fa-notes-medical', updated:'2025-05-02', href:'#' },

  // Consentimentos gerais
  { id:'consentimento-geral', title:'Termo de Consentimento (Geral)', cat:'Consentimento', tag:'consentimento', icon:'fa-file-signature', updated:'2025-06-14', href:'#' },
  { id:'consentimento-imagem', title:'Autorização de Uso de Imagem', cat:'LGPD / Imagem', tag:'consentimento', icon:'fa-camera', updated:'2025-03-28', href:'#' },
  { id:'consentimento-rede-social', title:'Consentimento para Fotografias e Redes Sociais', cat:'LGPD / Imagem', tag:'consentimento', icon:'fa-photo-film', updated:'2025-03-28', href:'#' },

  // Administrativo / LGPD
  { id:'lgpd-privacidade', title:'Termo de Privacidade (LGPD)', cat:'Administrativo', tag:'administrativo', icon:'fa-shield-halved', updated:'2025-02-17', href:'#' },
  { id:'contrato-tratamento', title:'Contrato de Tratamento / Responsabilidade Financeira', cat:'Administrativo', tag:'administrativo', icon:'fa-file-contract', updated:'2025-06-01', href:'#' },
  { id:'autorizacao-prontuario', title:'Autorização de Fornecimento/Transferência de Prontuário', cat:'Administrativo', tag:'administrativo', icon:'fa-folder-open', updated:'2025-05-15', href:'#' },
  { id:'declaracao-comparecimento', title:'Declaração de Comparecimento', cat:'Administrativo', tag:'administrativo', icon:'fa-id-card', updated:'2025-04-19', href:'#' },

  // Orçamento / Plano
  { id:'plano-tratamento', title:'Plano de Tratamento + Orçamento', cat:'Administrativo', tag:'administrativo', icon:'fa-list-check', updated:'2025-05-14', href:'#' },

  // Clínicos por especialidade
  { id:'ortodontia-consent', title:'Consentimento – Ortodontia (colagem/ajuste/retirada)', cat:'Ortodontia', tag:'ortodontia', icon:'fa-tooth', updated:'2025-06-20', href:'#' },
  { id:'implante-consent', title:'Consentimento – Implante / Enxerto', cat:'Implantodontia', tag:'implante', icon:'fa-screwdriver-wrench', updated:'2025-05-30', href:'#' },
  { id:'cirurgia-consent', title:'Consentimento – Cirurgia Oral Menor (exodontia, etc.)', cat:'Cirurgia', tag:'cirurgia', icon:'fa-user-doctor', updated:'2025-06-05', href:'#' },
  { id:'endodontia-consent', title:'Consentimento – Endodontia (canal)', cat:'Endodontia', tag:'endodontia', icon:'fa-tooth', updated:'2025-06-07', href:'#' },
  { id:'periodontia-consent', title:'Consentimento – Periodontia', cat:'Periodontia', tag:'periodontia', icon:'fa-leaf', updated:'2025-05-26', href:'#' },
  { id:'clareamento-consent', title:'Consentimento – Clareamento', cat:'Estética', tag:'estetica', icon:'fa-sparkles', updated:'2025-04-21', href:'#' },
  { id:'laminas-lentes', title:'Consentimento – Lentes / Laminados', cat:'Estética', tag:'estetica', icon:'fa-gem', updated:'2025-04-21', href:'#' },
  { id:'bichectomia-consent', title:'Consentimento – Bichectomia', cat:'Cirurgia / Estética', tag:'cirurgia estetica', icon:'fa-scissors', updated:'2025-04-11', href:'#' },

  // Prescrições
  { id:'receita', title:'Receita / Prescrição', cat:'Clínica', tag:'administrativo', icon:'fa-prescription-bottle-medical', updated:'2025-06-03', href:'#' },
  { id:'atestado', title:'Atestado / Afastamento', cat:'Administrativo', tag:'administrativo', icon:'fa-file-medical', updated:'2025-06-03', href:'#' },

  // Radiologia
  { id:'solicitacao-radiografia', title:'Solicitação de Radiografia / Ortopantomografia', cat:'Radiologia', tag:'radiologia', icon:'fa-x-ray', updated:'2025-05-10', href:'#' },
];

/* =========== Renderização de cards =========== */
function iconFor(m){
  // só usa Font Awesome regular/solid já importado
  return `<div class="doc-icon"><i class="fa-solid ${m.icon}"></i></div>`;
}

function actionsFor(m){
  // Ações fictícias (placeholder). "href" pode abrir um form ou página específica.
  const fillHref = m.href && m.href !== '#'
    ? m.href
    : 'javascript:void(0)';
  return `
    <div class="d-flex" style="gap:8px; flex-wrap:wrap">
      <a href="${fillHref}" class="btn btn-sm btn-outline-secondary btn-pill" ${m.href==='#' ? 'onclick="alert(\'Preenchimento deste modelo será adicionado.\')"' : ''}>
        <i class="fa-regular fa-pen-to-square mr-1"></i> Preencher
      </a>
      <button class="btn btn-sm btn-outline-secondary btn-pill" onclick="alert('Impressão/PDF em breve')">
        <i class="fa-regular fa-file-pdf mr-1"></i> PDF
      </button>
      <button class="btn btn-sm btn-outline-secondary btn-pill" onclick="alert('Link de compartilhamento gerado!')">
        <i class="fa-regular fa-share-from-square mr-1"></i> Compartilhar
      </button>
    </div>`;
}

function cardTemplate(m){
  return `
    <div class="crm-card doc-card" data-tags="${m.tag}">
      ${iconFor(m)}
      <div style="flex:1; min-width:0">
        <div class="doc-title">${m.title}</div>
        <div class="doc-meta">${m.cat} • Atualizado em ${new Date(m.updated).toLocaleDateString('pt-BR')}</div>
        <div class="mt-2">${actionsFor(m)}</div>
      </div>
    </div>
  `;
}

function renderGrid(filter='tudo', q=''){
  const grid = document.getElementById('doc-grid');
  grid.innerHTML = '';

  const term = (q||'').trim().toLowerCase();
  const list = MODELOS.filter(m => {
    const byTag = filter==='tudo' ? true : (m.tag||'').includes(filter);
    const byText = !term ? true :
      [m.title, m.cat, m.tag].join(' ').toLowerCase().includes(term);
    return byTag && byText;
  });

  if(!list.length){
    grid.innerHTML = `
      <div class="crm-card">
        <div class="h6 mb-1">Nenhum documento encontrado</div>
        <div class="muted">Ajuste os filtros ou a busca.</div>
      </div>`;
    return;
  }

  list.forEach(m => grid.insertAdjacentHTML('beforeend', cardTemplate(m)));
}

/* =========== Interações =========== */
document.addEventListener('DOMContentLoaded', () => {
  // Nav ativa
  const nav = document.querySelector('.crm-nav a[href="documentos.html"]');
  if(nav) nav.classList.add('active');

  // Render inicial
  renderGrid('tudo','');

  // Chips de filtro
  document.querySelectorAll('.doc-chip').forEach(ch => {
    ch.addEventListener('click', () => {
      document.querySelectorAll('.doc-chip').forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');
      const filter = ch.dataset.filter || 'tudo';
      const q = document.getElementById('doc-search').value;
      renderGrid(filter, q);
    });
  });

  // Busca
  document.getElementById('btn-search').addEventListener('click', ()=>{
    const actChip = document.querySelector('.doc-chip.active');
    const filter = actChip ? actChip.dataset.filter : 'tudo';
    renderGrid(filter, document.getElementById('doc-search').value);
  });
  document.getElementById('doc-search').addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') document.getElementById('btn-search').click();
  });

  // Modal Novo documento
  const sel = document.getElementById('nd-modelo');
  MODELOS.forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.id; opt.textContent = `${m.title} — ${m.cat}`;
    sel.appendChild(opt);
  });

  document.getElementById('btn-new').addEventListener('click', ()=> $('#md-new-doc').modal('show'));

  document.getElementById('form-new-doc').addEventListener('submit', (e)=>{
    e.preventDefault();
    const modelo = sel.value;
    const found = MODELOS.find(m=>m.id===modelo);
    $('#md-new-doc').modal('hide');
    if(found && found.href && found.href!=='#'){
      // Abre página/flow do modelo
      window.location.href = found.href;
    }else{
      alert('Iniciaremos o preenchimento deste modelo em breve.');
    }
  });

  // Sidebar (caso não use o sidebar.js, deixo fallback)
  const app = document.querySelector('.crm-app');
  const btn = document.getElementById('btn-sidebar');
  const overlay = document.getElementById('crm-overlay');
  function close(){ app.classList.remove('sidebar-open'); }
  function toggle(){ app.classList.toggle('sidebar-open'); }
  btn?.addEventListener('click', toggle);
  overlay?.addEventListener('click', close);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
  document.querySelectorAll('.crm-nav a').forEach(a => a.addEventListener('click', close));
});
</script>
<!-- Action Sheet: Atalhos do botão "Lista" -->
<div id="crm-menu-sheet" class="crm-action-sheet">
  <div class="sheet-header">Ir para</div>
  <a class="sheet-item" href="inicio.html"><i class="fa-solid fa-house"></i> Início</a>
  <a class="sheet-item" href="agenda.html"><i class="fa-regular fa-calendar-days"></i> Agenda</a>
  <a class="sheet-item" href="pacientes.html"><i class="fa-regular fa-user"></i> Pacientes</a>
  <a class="sheet-item" href="orcamentos.html"><i class="fa-regular fa-folder-open"></i> Orçamentos</a>
  <a class="sheet-item" href="procedimentos.html"><i class="fa-solid fa-tooth"></i> Procedimentos</a>
  <a class="sheet-item" href="procedimentos.html"><i class="fa-solid fa-notes-medical"></i> Documentos</a>
  <a class="sheet-item" href="configuracoes.html"><i class="fa-solid fa-gear"></i> Configurações</a>
</div>
<!-- BOTTOM BAR • DRIBBBLE-LIKE -->
<nav class="bb-dribbble" id="bbBar" aria-label="Navegação rápida">
  <!-- fundo com onda + notch -->
  <svg class="bb-bg" viewBox="0 0 1000 160" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <filter id="bbShadow" x="-20%" y="-50%" width="140%" height="200%">
        <feDropShadow dx="0" dy="14" stdDeviation="12" flood-color="rgba(15,23,42,.10)"/>
        <feDropShadow dx="0" dy="4"  stdDeviation="6"  flood-color="rgba(15,23,42,.08)"/>
      </filter>
    </defs>

    <!-- Path com notch (estado “em repouso”) -->
    <path id="bbPath" class="bb-path" filter="url(#bbShadow)"
      d="M18,26
         H360
         C420,26 440,6 500,6
         C560,6 580,26 640,26
         H982 Q994,26 994,38 V140
         Q994,152 982,152 H18 Q6,152 6,140 V38 Q6,26 18,26 Z" />

    <!-- Morph da onda ao tocar -->
    <animate id="bbMorph" xlink:href="#bbPath" attributeName="d" dur="420ms" fill="freeze"
      values="
        M18,26 H360 C420,26 440,6 500,6 C560,6 580,26 640,26 H982 Q994,26 994,38 V140 Q994,152 982,152 H18 Q6,152 6,140 V38 Q6,26 18,26 Z;
        M18,26 H330 C400,26 440,-18 500,-18 C560,-18 600,26 670,26 H982 Q994,26 994,38 V140 Q994,152 982,152 H18 Q6,152 6,140 V38 Q6,26 18,26 Z;
        M18,26 H360 C420,26 440,6 500,6 C560,6 580,26 640,26 H982 Q994,26 994,38 V140 Q994,152 982,152 H18 Q6,152 6,140 V38 Q6,26 18,26 Z
      " />
  </svg>

  <!-- Slots (mesma “placa”, sem borda) -->
  <button class="bb-tab" data-act="agenda" aria-label="Agenda">
    <i class="fa-regular fa-calendar-days"></i>
    <span>Agenda</span>
  </button>

  <button class="bb-fab" data-act="quick" aria-label="Ações rápidas">
    <i class="fa-solid fa-plus"></i>
  </button>

  <button class="bb-tab" data-act="menu" aria-label="Menu">
    <i class="fa-solid fa-list-ul"></i>
    <span>Menu</span>
  </button>
</nav>


<script>
(function () {
  const bar     = document.getElementById('crm-bottombar');
  const overlay = document.getElementById('crm-sheet-overlay');
  const quick   = document.getElementById('crm-quick-sheet');
  const menu    = document.getElementById('crm-menu-sheet');

  if (!bar) return;

  const openSheet = sheet => {
    closeSheets();
    overlay.classList.add('show');
    sheet.classList.add('show');
  };
  const closeSheets = () => {
    overlay.classList.remove('show');
    quick.classList.remove('show');
    menu.classList.remove('show');
  };

  // Navegação dos botões principais
  bar.addEventListener('click', (e) => {
    const act = e.target.closest('button')?.dataset?.act;
    if (!act) return;

    if (act === 'agenda') {
      window.location.href = 'agenda.html';
    } else if (act === 'menu') {
      openSheet(menu);
    } else if (act === 'quick') {
      openSheet(quick);
    }
  });

  // Fecha overlay
  overlay.addEventListener('click', closeSheets);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeSheets(); });

  // Ações rápidas (+)
  quick.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-quick]');
    if(!btn) return;
    const what = btn.dataset.quick;

    const openModal = (id, fallbackUrl) => {
      if (window.$ && $(id).length) { $(id).modal('show'); }
      else window.location.href = fallbackUrl;
    };

    if (what === 'agendamento') {
      openModal('#md-agendamento','inicio.html'); // ou agenda.html, se preferir
    }
    if (what === 'paciente') {
      openModal('#md-paciente','inicio.html');
    }
    if (what === 'orcamento') {
      openModal('#md-orcamento','orcamentos.html');
    }
    if (what === 'procedimentos') {
      window.location.href = 'procedimentos.html';
    }
    closeSheets();
  });
})();
</script>

<script>
(function(){
  const API_BASE = (window.CRM_API_BASE || '').replace(/\/+$/,'');
  const UL = document.getElementById('upcoming-list');

  const qs = o => {
    const p = new URLSearchParams();
    Object.entries(o||{}).forEach(([k,v])=>{
      if(v!==undefined && v!==null && v!=='') p.append(k, String(v));
    });
    return p.toString() ? '?' + p.toString() : '';
  };

  function labelData(startISO, allDay){
    const d  = new Date(startISO);
    const n  = new Date();
    const d0 = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    const n0 = new Date(n.getFullYear(), n.getMonth(), n.getDate());
    const diffDays = Math.round((d0 - n0)/86400000);

    const hhmm = allDay ? '' : ' ' + d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
    if (diffDays === 0) return 'Hoje'    + hhmm;
    if (diffDays === 1) return 'Amanhã'  + hhmm;
    return d.toLocaleDateString('pt-BR', { weekday:'short' }) + hhmm; // ex: seg., ter., qua...
  }

  function render(items){
    UL.innerHTML = '';
    if(!items || !items.length){
      UL.innerHTML = '<li class="py-2 text-muted">Sem próximos agendamentos</li>';
      return;
    }
    items.forEach(ev=>{
      const when = labelData(ev.start, ev.allDay);
      const li = document.createElement('li');
      li.className = 'py-2 border-bottom';
      li.innerHTML = `
        <i class="fa-regular fa-clock mr-2" style="color:#10b981"></i>
        <strong>${when}</strong> – ${ev.title || '(sem título)'}
      `;
      UL.appendChild(li);
    });
  }

  async function loadUpcoming(){
    try{
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const url = API_BASE + '/calendar/upcoming' + qs({ days: 7, limit: 3, tz });
      const data = await CRMApi.getCalendarUpcoming({days:7, limit:3});
      const data = await res.json();
      const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : []);
      render(items);
    }catch(err){
      console.error(err);
      UL.innerHTML = '<li class="py-2 text-danger">Erro ao carregar agenda</li>';
    }
  }

  loadUpcoming();
})();
</script>

<script>
(function(){
  const bar = document.getElementById('bbBar');
  if(!bar) return;

  const tabAgenda = bar.querySelector('.bb-tab[data-act="agenda"]');
  const tabMenu   = bar.querySelector('.bb-tab[data-act="menu"]');
  const fab       = bar.querySelector('.bb-fab');
  const morph     = document.getElementById('bbMorph');

  // seus sheets existentes
  const overlay = document.getElementById('crm-sheet-overlay');
  const quick   = document.getElementById('crm-quick-sheet');
  const menu    = document.getElementById('crm-menu-sheet');
  const openSheet = el => { overlay?.classList.add('show'); el?.classList.add('show'); };
  const closeSheets = () => { overlay?.classList.remove('show'); quick?.classList.remove('show'); menu?.classList.remove('show'); };
  overlay?.addEventListener('click', closeSheets);
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeSheets(); });

  function wave(){ try{ morph.beginElement(); }catch(e){} }
  function bounce(el){
    const i = el.querySelector('i'), s=el.querySelector('span');
    i?.classList.remove('bb-bounce'); s?.classList.remove('bb-bounce');
    void i?.offsetWidth; void s?.offsetWidth; // reflow
    i?.classList.add('bb-bounce'); s?.classList.add('bb-bounce');
  }
  function setActive(btn){
    [tabAgenda, tabMenu].forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }

  tabAgenda.addEventListener('click', ()=>{
    setActive(tabAgenda); wave(); bounce(tabAgenda);
    setTimeout(()=> location.href='agenda.html', 120);
  });

  tabMenu.addEventListener('click', ()=>{
    setActive(tabMenu); wave(); bounce(tabMenu);
    openSheet(menu);
  });

  fab.addEventListener('click', ()=>{
    wave(); fab.classList.remove('bb-fab-pop'); void fab.offsetWidth; fab.classList.add('bb-fab-pop');
    openSheet(quick);
  });

  // estado inicial
  setActive(tabAgenda);
})();
</script>

</body>
</html>








