<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="dentista, clínica odontológica, implantes, ortodontia, estética dental" />
  <meta name="description" content="Clínica odontológica moderna com atendimento especializado." />
  <meta name="author" content="Elen Nogata" />
  <link rel="shortcut icon" href="images/favicon.png" type="">
  <title>Elen Nogata</title>

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <!--owl slider stylesheet -->
  <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <!-- nice select  -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css" />
  <!-- font awesome style -->
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <!-- responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />
</head>

<body>

  <div class="hero_area">
    <div class="bg-box">
      <img src="images/hero-bg.jpg" alt="">
      <div class="overlay"></div>
    </div>

    <!-- header section -->
    <header class="header_section">
      <div class="container">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span>Elen Nogata</span>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse"
                  data-target="#navbarSupportedContent">
            <span class=""></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto ">
              <li class="nav-item active"><a class="nav-link" href="index.html">Início</a></li>
              <li class="nav-item"><a class="nav-link" href="menu.html">Serviços</a></li>
              <li class="nav-item"><a class="nav-link" href="about.html">Profissional</a></li>
              <li class="nav-item"><a class="nav-link" href="book.html">Agendar Consulta</a></li>
            </ul>
            <div class="user_option">
              <a href="tel:+5511999999999" class="order_online">Ligue Agora</a>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- slider section -->
    <section class="slider_section">
      <div id="customCarousel1" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="container ">
              <div class="row">
                <div class="col-md-7 col-lg-6">
                  <div class="detail-box">
                    <h1>Sorriso Saudável</h1>
                    <p>Tratamentos odontológicos modernos e acessíveis, para devolver a confiança ao seu sorriso.</p>
                    <div class="btn-box">
                      <a href="book.html" class="btn1">Agendar Consulta</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item ">
            <div class="container ">
              <div class="row">
                <div class="col-md-7 col-lg-6">
                  <div class="detail-box">
                    <h1>Atendimento Humanizado</h1>
                    <p>Cuidamos da sua saúde bucal com carinho, tecnologia e uma equipe altamente qualificada.</p>
                    <div class="btn-box">
                      <a href="menu.html" class="btn1">Conheça os Serviços</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <ol class="carousel-indicators">
          <li data-target="#customCarousel1" data-slide-to="0" class="active"></li>
          <li data-target="#customCarousel1" data-slide-to="1"></li>
        </ol>
      </div>
    </section>
  </div>

  <!-- services section -->
  <section class="food_section layout_padding-bottom">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>Nossos Serviços</h2>
      </div>
      <div class="row grid">
        <div class="col-sm-6 col-lg-4 all">
          <div class="box">
            <div class="img-box"><img src="images/f1.png" alt=""></div>
            <div class="detail-box">
              <h5>Implantes Dentários</h5>
              <p>Reposição segura e duradoura de dentes perdidos.</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 all">
          <div class="box">
            <div class="img-box"><img src="images/f2.png" alt=""></div>
            <div class="detail-box">
              <h5>Ortodontia</h5>
              <p>Aparelhos modernos para alinhar seu sorriso com conforto e estética.</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 all">
          <div class="box">
            <div class="img-box"><img src="images/f3.png" alt=""></div>
            <div class="detail-box">
              <h5>Estética Dental</h5>
              <p>Clareamento, facetas e soluções para deixar seus dentes ainda mais bonitos.</p>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-box">
        <a href="menu.html">Ver Todos os Serviços</a>
      </div>
    </div>
  </section>

  <!-- about section -->
  <section class="about_section layout_padding_profissional">
    <div class="container">
      <div class="row">
        <div class="col-md-6 ">
          <div class="img-box">
            <img src="images/about-img.png" alt="">
          </div>
        </div>
        <div class="col-md-6">
          <div class="detail-box">
            <h2>Dra Elen Nogata</h2>
            <p>Unindo tecnologia de ponta, equipe experiente e um atendimento humanizado para cuidar do seu sorriso em todas as fases da vida.</p>
            <a href="about.html">Saiba Mais</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- book section -->
  <section class="book_section layout_padding" id="booking">
    <div class="container">
      <div class="heading_container">
        <h2>Agende sua Consulta</h2>
        <p style="max-width:720px;color:#64748b">
          Escolha uma data para ver os horários disponíveis em tempo real. Você também pode conversar com nosso agente para agendar.
        </p>
      </div>

      <div class="row align-items-stretch">
        <div class="col-12 col-md-6 d-flex">

          <!-- ===== BOOKING WIDGET ===== -->
          <style>
            .bk-card{border:1px solid #e5e7eb;border-radius:16px;background:#fff;padding:14px;margin: 10px 0 0 0}
            .bk-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
            .bk-head .month{font-weight:800}
            .bk-btn-link{background:none;border:0;padding:6px 10px;border-radius:10px}
            .bk-cal{user-select:none}
            .bk-dow,.bk-grid{display:grid;grid-template-columns:repeat(7,1fr)}
            .bk-dow{gap:4px;color:#6b7280;font-size:.8rem;margin:6px 0}
            .bk-dow div{padding:6px;text-align:center}
            .bk-grid{gap:6px}
            .bk-day{position:relative;text-align:center;padding:10px 0;border-radius:12px;cursor:pointer;transition:.2s}
            .bk-day:hover{background:#f3f4f6}
            .bk-day.out{opacity:.35;cursor:default}
            .bk-day .num{font-weight:600}
            .bk-day .dot{position:absolute;left:50%;transform:translateX(-50%);bottom:6px;width:6px;height:6px;border-radius:999px;background:#22c55e;opacity:.15}
            .bk-day.avail .dot{opacity:1}
            .bk-day.sel{background:#e0f2fe;outline:2px solid #bae6fd}
            .bk-slots-title{font-weight:700;margin:12px 0 6px}
            .bk-slots{display:flex;flex-wrap:wrap;gap:8px}
            .bk-slot{border:1px solid #e5e7eb;background:#fff;padding:.45rem .7rem;border-radius:999px;font-size:.95rem}
            .bk-slot:hover{border-color:#cbd5e1}
            .bk-slot[disabled]{opacity:.35;cursor:not-allowed}
            .bk-slot.active{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
            .bk-actions{display:flex;gap:10px;margin-top:12px}
            /* deixa o btn1 (tema) com estado "desabilitado" para o agendamento */
            .bk-actions .btn1.disabled{opacity:.55;pointer-events:none;filter:grayscale(.1)}
            @media(min-width:992px){.bk-wrap{display:grid;grid-template-columns:360px 1fr;gap:16px}}
            /* ===== Modal estilizado ===== */
.bk-modal{border:1px solid #e5e7eb;border-radius:18px;overflow:hidden}
.bk-modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 18px;background:#0ea5e9;color:#fff}
.bk-title-eyebrow{display:block;font-size:.7rem;letter-spacing:.08em;opacity:.9;text-transform:uppercase}
.bk-title-main{margin:2px 0 0;font-weight:800}
.bk-close{background:rgba(255,255,255,.15);border:0;color:#fff;border-radius:10px;width:36px;height:36px}
.bk-close:hover{background:rgba(255,255,255,.25)}

.bk-summary{padding:12px 18px;background:#f8fafc;border-bottom:1px solid #eef2f7}
.bk-chip{display:inline-flex;gap:8px;align-items:center;background:#e0f2fe;border:1px solid #bae6fd;color:#0c4a6e;border-radius:999px;padding:6px 12px;font-weight:600}
.bk-chip i{color:#0369a1}

.bk-modal-body{padding:16px 18px}
.bk-label{font-weight:700;margin-bottom:6px;display:block}
.bk-input{position:relative}
.bk-input i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#64748b}
.bk-input .form-control{padding-left:36px}
.bk-privacy{display:flex;align-items:center;gap:8px;margin-top:6px;font-size:.9rem;color:#64748b}
.bk-privacy i{color:#10b981}

.bk-modal-footer{display:flex;gap:10px;justify-content:flex-end;padding:14px 18px;border-top:1px solid #eef2f7;background:#fcfdff}

#lead-form.was-validated .form-control:invalid{border-color:#ef4444}
#lead-form.was-validated .form-control:invalid~.invalid-feedback{display:block}

.btn-primary{background:#0ea5e9;border-color:#0ea5e9}
.btn-primary:hover{background:#0284c7;border-color:#0284c7}

.bk-spinner{width:1rem;height:1rem;border:.18rem solid #fff;border-right-color:transparent;border-radius:50%;display:inline-block;animation:bkspin .7s linear infinite;vertical-align:-2px}
@keyframes bkspin{to{transform:rotate(360deg)}}

          </style>

          <div class="bk-wrap w-100">
            <!-- calendário -->
            <div class="bk-card">
              <div class="bk-head">
                <button class="bk-btn-link" id="bk-prev" aria-label="Mês anterior">
                  <i class="fa fa-chevron-left"></i>
                </button>
                <div class="month" id="bk-month">—</div>
                <button class="bk-btn-link" id="bk-next" aria-label="Próximo mês">
                  <i class="fa fa-chevron-right"></i>
                </button>
              </div>

              <div class="bk-cal">
                <div class="bk-dow">
                  <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
                </div>
                <div class="bk-grid" id="bk-grid"></div>
              </div>
            </div>

            <!-- horários -->
            <div class="bk-card">
              <div class="bk-slots-title">
                Horários <span id="bk-day-label" class="text-muted" style="font-weight:500"></span>
              </div>
              <div id="bk-slots" class="bk-slots">Selecione um dia do calendário…</div>

              <div class="bk-actions">
                <a id="bk-submit" class="btnAgendar" href="javascript:void(0)">Agendar</a>
                <a id="bk-chat" class="btnAgendarwpp" target="_blank" rel="noopener">Agendar via Whatsapp</a>
              </div>
              <div id="bk-feedback" class="mt-2"></div>
            </div>
          </div>

       <!-- Modal: Finalizar agendamento (novo) -->
<div class="modal fade" id="md-lead" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content bk-modal" id="lead-form" novalidate>
      <div class="bk-modal-header">
        <div class="bk-title">
          <span class="bk-title-eyebrow">Agendamento</span>
          <h5 class="bk-title-main">Finalizar consulta</h5>
        </div>
        <button type="button" class="bk-close" data-dismiss="modal" aria-label="Fechar">
          <i class="fa fa-times"></i>
        </button>
      </div>

      <!-- resumo -->
      <div class="bk-summary">
        <div class="bk-chip">
          <i class="fa fa-calendar"></i>
          <span id="lead-when">Você está marcando para —</span>
        </div>
      </div>

      <div class="bk-modal-body">
        <div class="form-group">
          <label class="bk-label">Nome</label>
          <div class="bk-input">
            <i class="fa fa-user"></i>
            <input id="lead-name" class="form-control" placeholder="Seu nome completo" required>
          </div>
          <div class="invalid-feedback">Informe seu nome.</div>
        </div>

        <div class="form-group">
          <label class="bk-label">Telefone (WhatsApp)</label>
          <div class="bk-input">
            <i class="fa fa-whatsapp"></i>
            <input id="lead-phone" class="form-control" inputmode="numeric" placeholder="(11) 9 9999-9999" required>
          </div>
          <div class="invalid-feedback">Informe um WhatsApp válido.</div>
        </div>

        <div class="form-group">
          <label class="bk-label">E-mail <span class="text-muted">(opcional)</span></label>
          <div class="bk-input">
            <i class="fa fa-envelope"></i>
            <input id="lead-email" class="form-control" type="email" placeholder="voce@exemplo.com">
          </div>
        </div>

        <div class="form-group">
          <label class="bk-label">Observações <span class="text-muted">(opcional)</span></label>
          <textarea id="lead-notes" class="form-control" rows="2" placeholder="Ex.: sensibilidade, preferências…"></textarea>
        </div>

        <div class="bk-privacy">
          <i class="fa fa-shield"></i>
          Seus dados são usados apenas para confirmar o agendamento.
        </div>
      </div>

      <div class="bk-modal-footer">
        <button class="btn btn-light" data-dismiss="modal" type="button">Cancelar</button>
        <button class="btn btn-primary" type="submit" id="lead-send">
          <span class="bk-spinner d-none"></span>
          <span class="bk-cta-text">Confirmar</span>
        </button>
      </div>
    </form>
  </div>
</div>




          <script>
            /* ===== CONFIG ===== */
            const TZ = 'America/Sao_Paulo';
            const AVAILABILITY_URL = 'https://primary-odonto.up.railway.app/webhook/availability/';
            const BOOK_URL = 'https://primary-odonto.up.railway.app/webhook/odonto/book';

            /* ===== HELPERS ===== */
            const el=(q,r=document)=>r.querySelector(q), els=(q,r=document)=>Array.from(r.querySelectorAll(q));
            const pad2=n=>String(n).padStart(2,'0');
            const ymd=d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
            const fmtBR=iso=>{try{const [y,m,d]=iso.split('-');return `${d}/${m}/${y}`;}catch{return iso;}};
            // Cria Date LOCAL para 'YYYY-MM-DD' (evita bug de fuso voltando um dia)
            const parseLocalYMD = s => { const [y,m,d]=s.split('-').map(Number); const dt=new Date(y,m-1,d); dt.setHours(0,0,0,0); return dt; };

            function rangeToSlots(start,end,step){
              const out=[],[sh,sm]=start.split(':').map(Number),[eh,em]=end.split(':').map(Number);
              let d=new Date(); d.setHours(sh,sm,0,0); const z=new Date(); z.setHours(eh,em,0,0);
              while(d<z){ out.push(`${pad2(d.getHours())}:${pad2(d.getMinutes())}`); d=new Date(d.getTime()+step*60000); }
              return out;
            }
            function blockByBusy(slots,busy){
              const toMin=t=>{const[h,m]=t.split(':').map(Number);return h*60+m};
              return slots.map(t=>{
                const tm=toMin(t);
                const kk=(busy||[]).some(([a,b])=>tm>=toMin(a)&&tm<toMin(b));
                return {time:t,available:!kk};
              });
            }

            // Busca disponibilidade do dia no seu webhook
            async function fetchAvailability(dateStr){
              const url = `${AVAILABILITY_URL}?date=${encodeURIComponent(dateStr)}&tz=${encodeURIComponent(TZ)}`;
              const res = await fetch(url, { headers:{ Accept:'application/json' } });
              if (!res.ok) throw new Error(await res.text());
              const data = await res.json();

              // Normaliza busy quando vier em ISO
              const toHM = (iso) => new Intl.DateTimeFormat('pt-BR',{
                hour:'2-digit', minute:'2-digit', hour12:false, timeZone: TZ
              }).format(new Date(iso));

              if (Array.isArray(data?.busy) && data.busy.length) {
                if (typeof data.busy[0] === 'object') {
                  data.busy = data.busy.map(x => [toHM(x.start), toHM(x.end)]);
                }
              } else {
                data.busy = [];
              }
              return data;
            }

            /* ===== STATE/ELS ===== */
            const gMonth=el('#bk-month'), gGrid=el('#bk-grid'), btnPrev=el('#bk-prev'), btnNext=el('#bk-next');
            const labDay=el('#bk-day-label'), slotsEl=el('#bk-slots'), linkGo=el('#bk-submit'), chatA=el('#bk-chat'), fb=el('#bk-feedback');
            const leadForm=el('#lead-form'), inName=el('#lead-name'), inPhone=el('#lead-phone'), inEmail=el('#lead-email'), leadWhen=el('#lead-when');

            let anchor=new Date();   // mês corrente
            let selDate=new Date();  // dia selecionado
            let selTime='';          // horário selecionado

            const dayHTML=(d,{out=false,avail=false,sel=false}={}) =>
              `<div class="bk-day ${out?'out':''} ${avail?'avail':''} ${sel?'sel':''}" data-date="${ymd(d)}" ${out?'data-out="1"':''}>
                 <span class="num">${d.getDate()}</span><span class="dot"></span>
               </div>`;

            const startOfMonth=d=>new Date(d.getFullYear(),d.getMonth(),1);
            const endOfMonth=d=>new Date(d.getFullYear(),d.getMonth()+1,0);
            function headerMonth(){
              const m=anchor.toLocaleDateString('pt-BR',{month:'long',year:'numeric'});
              gMonth.textContent=m.charAt(0).toUpperCase()+m.slice(1);
            }

            async function availabilityMapForMonth(days){
              const map={}, chunks=[]; for(let i=0;i<days.length;i+=14) chunks.push(days.slice(i,i+14));
              for(const ch of chunks){
                await Promise.all(ch.map(async d=>{
                  try{
                    const a=await fetchAvailability(ymd(d));
                    const base = (Array.isArray(a.slots) && a.slots.length)
                      ? a.slots
                      : rangeToSlots(a?.officeHours?.start||'08:00', a?.officeHours?.end||'18:00', a?.intervalMinutes||30);
                    map[ymd(d)] = (Array.isArray(a.slots) && a.slots.length)
                      ? base.length>0
                      : blockByBusy(base,a?.busy||[]).some(s=>s.available);
                  }catch{}
                }));
              }
              return map;
            }

            async function renderMonth(){
              headerMonth();
              const first=startOfMonth(anchor), last=endOfMonth(anchor), pad=first.getDay(), total=last.getDate();
              const cells=[]; const prev=new Date(first); prev.setDate(1-pad);
              for(let i=0;i<pad;i++){const d=new Date(prev);d.setDate(prev.getDate()+i);cells.push({date:d,out:true});}
              for(let i=1;i<=total;i++) cells.push({date:new Date(first.getFullYear(),first.getMonth(),i),out:false});
              while(cells.length%7!==0){const d=new Date(last);d.setDate(last.getDate()+(cells.length%7));cells.push({date:d,out:true});}
              const avMap=await availabilityMapForMonth(cells.filter(c=>!c.out).map(c=>c.date));
              gGrid.innerHTML=cells.map(c=>{
                const id=ymd(c.date),sel=id===ymd(selDate);
                return dayHTML(c.date,{out:c.out,avail:!!avMap[id],sel});
              }).join('');
              gGrid.querySelectorAll('.bk-day').forEach(div=>{
                if(div.dataset.out==='1') return;
                div.addEventListener('click',()=>{
                  selDate = parseLocalYMD(div.dataset.date); // <<<<<< evita voltar um dia
                  els('.bk-day.sel',gGrid).forEach(x=>x.classList.remove('sel'));
                  div.classList.add('sel');
                  loadSlotsForDay();
                });
              });
            }

            async function loadSlotsForDay(){
              const ds=ymd(selDate);
              labDay.textContent='• '+fmtBR(ds);
              selTime=''; linkGo.classList.add('disabled'); fb.textContent='';
              slotsEl.innerHTML='Carregando horários…';

              try{
                const bag = await fetchAvailability(ds);
                const step = bag?.intervalMinutes || 60;                 // fallback
                const start= bag?.officeHours?.start || '08:00';
                const end  = bag?.officeHours?.end   || '18:00';

                const base = (Array.isArray(bag.slots) && bag.slots.length)
                  ? bag.slots
                  : rangeToSlots(start,end,step);

                const withStatus = (Array.isArray(bag.slots) && bag.slots.length)
                  ? base.map(t => ({ time:t, available:true }))
                  : blockByBusy(base, bag.busy);

                if(!withStatus.some(s=>s.available)){
                  slotsEl.innerHTML = '<div class="text-muted">Sem horários disponíveis neste dia.</div>';
                  return;
                }

                slotsEl.innerHTML = withStatus.map(s =>
                  `<button class="bk-slot ${s.available?'':'disabled'}" ${s.available?'':'disabled'} data-time="${s.time}">${s.time}</button>`
                ).join('');

                // seleção
                slotsEl.querySelectorAll('.bk-slot:not(.disabled)').forEach(b=>{
                  b.addEventListener('click', ()=>{
                    els('.bk-slot.active',slotsEl).forEach(x=>x.classList.remove('active'));
                    b.classList.add('active');
                    selTime=b.dataset.time;
                    linkGo.classList.remove('disabled');
                    const msg=encodeURIComponent(`Olá! Quero agendar ${fmtBR(ds)} às ${selTime}.`);
                    chatA.href=`https://wa.me/5511987562810?text=${msg}`;
                  });
                });

              }catch(e){
                console.error(e);
                slotsEl.innerHTML='<div class="text-danger">Erro ao carregar horários.</div>';
              }
            }

            // Abrir modal quando clicar em "Agendar Agora"
            linkGo.addEventListener('click', ()=>{
              if (linkGo.classList.contains('disabled')) return;
              leadWhen.textContent = `Você está marcando para ${fmtBR(ymd(selDate))} às ${selTime}.`;
              $('#md-lead').modal('show');
            });

            // Enviar agendamento ao webhook
            leadForm.addEventListener('submit', async (e)=>{
              e.preventDefault();
              const name=inName.value.trim(), phone=inPhone.value.trim(), email=inEmail.value.trim();
              if(!name || !phone){ return alert('Informe nome e WhatsApp.'); }
              el('#lead-send').disabled=true; el('#lead-send').textContent='Enviando…';
              try{
                const payload = {
                  paciente:name, phone, email,
                  data: ymd(selDate), hora: selTime, duracaoMin:60,
                  procedimento:'Consulta', canalPreferido:'WhatsApp',
                  confirmar:true, tz:TZ
                };
                const resp = await fetch(BOOK_URL, {
                  method:'POST', headers:{'Content-Type':'application/json'},
                  body: JSON.stringify(payload)
                });
                if(!resp.ok) throw new Error('Falha ao agendar');
                $('#md-lead').modal('hide');
                fb.innerHTML = '<div class="text-success">Agendado com sucesso! Você receberá a confirmação.</div>';
                leadForm.reset();
              }catch(err){
                fb.innerHTML = `<div class="text-danger">${err.message||'Erro ao agendar.'}</div>`;
              }finally{
                el('#lead-send').disabled=false; el('#lead-send').textContent='Confirmar';
              }
            });

            // navegação do mês
            btnPrev.addEventListener('click', ()=>{ anchor=new Date(anchor.getFullYear(),anchor.getMonth()-1,1); renderMonth(); });
            btnNext.addEventListener('click', ()=>{ anchor=new Date(anchor.getFullYear(),anchor.getMonth()+1,1); renderMonth(); });

            // boot
            (async function init(){ await renderMonth(); await loadSlotsForDay(); })();
          </script>

          <script>
  // Máscara leve para WhatsApp (sem plugins)
  const phoneMask = (v) => {
    return v
      .replace(/\D/g,'')
      .replace(/^(\d{2})(\d)/, '($1) $2')
      .replace(/(\d{5})(\d{4}).*/, '$1-$2')
  };
  const phoneInput = document.getElementById('lead-phone');
  phoneInput.addEventListener('input', (e)=> e.target.value = phoneMask(e.target.value));

  // Validação e feedback visual
  const form = document.getElementById('lead-form');
  const btnSend = document.getElementById('lead-send');
  const spin = btnSend.querySelector('.bk-spinner');
  const cta = btnSend.querySelector('.bk-cta-text');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    form.classList.add('was-validated');

    const name = document.getElementById('lead-name').value.trim();
    const phone= document.getElementById('lead-phone').value.replace(/\D/g,'');
    const email= document.getElementById('lead-email').value.trim();
    const notes= document.getElementById('lead-notes').value.trim();

    // regras simples
    if (!name || phone.length < 10) return;

    // loading state
    btnSend.disabled = true;
    spin.classList.remove('d-none');
    cta.textContent = 'Enviando…';

    try{
      // Envia para o mesmo BOOK_URL já usado no widget
      const payload = {
        paciente: name,
        phone: `+55${phone}`,
        email,
        notas: notes,
        data: ymd(selDate),
        hora: selTime,
        duracaoMin: 60,
        procedimento: 'Consulta',
        canalPreferido: 'WhatsApp',
        confirmar: true,
        tz: TZ
      };

      const r = await fetch(BOOK_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });

      if (!r.ok) throw new Error('Falha ao agendar');

      $('#md-lead').modal('hide');
      document.getElementById('bk-feedback').innerHTML =
        '<div class="text-success">Agendado com sucesso! Você receberá a confirmação no WhatsApp.</div>';
      form.reset();
      form.classList.remove('was-validated');

    }catch(err){
      document.getElementById('bk-feedback').innerHTML =
        `<div class="text-danger">${err.message || 'Erro ao agendar.'}</div>`;
    }finally{
      btnSend.disabled = false;
      spin.classList.add('d-none');
      cta.textContent = 'Confirmar';
    }
  });

  // Preenche o resumo quando abrir o modal
  // (você já atualiza `leadWhen` na ação do botão Agendar)
  // Ex.: leadWhen.textContent = `Você está marcando para ${fmtBR(ymd(selDate))} às ${selTime}.`;
</script>


        </div>
      </div>
    </div>
  </section>

  <!-- WhatsApp flutuante -->
  <a href="https://wa.me/5511987562810?text=Olá%20quero%20agendar%20uma%20consulta"
     target="_blank" id="whatsapp-btn">
    <img src="images/whatsappgif.gif" alt="WhatsApp" />
  </a>

  <style>
    #whatsapp-btn{position:fixed;bottom:35px;right:30px;z-index:9999;width:85px;height:85px}
    #whatsapp-btn img{width:100%;height:100%;object-fit:contain;border-radius:50%;cursor:pointer;transition:transform .3s ease}
    #whatsapp-btn img:hover{transform:scale(1.15)}
  </style>

  <!-- footer section -->
  <footer class="footer_section">
    <div class="container">
      <div class="row">
        <div class="col-md-4 footer-col">
          <div class="footer_contact">
            <h4>Contato</h4>
            <div class="contact_link_box">
              <a href="#"><i class="fa fa-map-marker" aria-hidden="true"></i><span>Av. Paulista, 1000 - São Paulo</span></a>
              <a href="tel:+5511999999999"><i class="fa fa-phone" aria-hidden="true"></i><span>(11) 99999-9999</span></a>
              <a href="mailto:contato@odontoprime.com"><i class="fa fa-envelope" aria-hidden="true"></i><span>contato@odontoprime.com</span></a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <div class="footer_detail">
            <a href="#" class="footer-logo">Dra Elen Nogata</a>
            <p>Cuidado, tecnologia e resultados que inspiram confiança ao sorrir.</p>
            <div class="footer_social">
              <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
              <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <h4>Horário</h4>
          <p>Seg a Sex: 9h - 19h</p>
          <p>Sáb: 9h - 14h</p>
        </div>
      </div>
      <div class="footer-info">
        <p>&copy; <span id="displayYear"></span> Lahntech. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- scripts -->
  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="js/bootstrap.js"></script>

  <!-- Plugins do tema (carregar ANTES do custom.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/jquery.nice-select.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js"></script>

  <!-- JS do tema -->
  <script src="js/custom.js"></script>

</body>
</html>







