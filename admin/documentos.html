<!DOCTYPE html><html lang="pt-BR"><head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CRM Odonto – Campanhas</title>
  <link rel="stylesheet" href="../css/bootstrap.css">
  <link rel="stylesheet" href="css/crm.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body data-page="campanhas">
<div class="crm-app">
 <!-- sidebar + shell comum -->
<div class="crm-app">
  <aside class="crm-sidebar">
    <div class="crm-brand">
      <span class="logo"></span>
      <div>
        <div style="font-weight:800; font-size:18px;">OdontoCRM</div>
        <div style="color:var(--muted); font-size:12px;">Clínica Elen Nogata</div>
      </div>
    </div>
    <nav class="crm-nav">
      <a href="inicio.html" data-nav="inicio"><i class="fa-solid fa-grid-2"></i> Início</a>
      <a href="agenda.html" data-nav="agenda"><i class="fa-regular fa-calendar-days"></i> Agenda</a>
      <a href="pacientes.html" data-nav="pacientes"><i class="fa-regular fa-user"></i> Pacientes</a>
      <a href="orcamentos.html" data-nav="orcamentos"><i class="fa-regular fa-folder-open"></i> Orçamentos</a>
      <a href="procedimentos.html" data-nav="procedimentos"><i class="fa-solid fa-tooth"></i> Procedimentos</a>
      <a href="campanhas.html" data-nav="campanhas"><i class="fa-regular fa-paper-plane"></i> Campanhas</a>
      <a href="configuracoes.html" data-nav="configuracoes"><i class="fa-solid fa-gear"></i> Configurações</a>
    </nav>
    <div class="crm-footer">
      <div>Conectado como <strong>admin@clinica</strong></div>
      <div>v0.1</div>
    </div>
  </aside>
  <main class="crm-main">
    <!-- HERO + CONTENT específicos de cada página aqui -->
  </main>
</div>
  <main class="crm-main">
    <section class="crm-hero">
      <h1 class="text-center mb-1">Campanhas</h1>
      <div class="crm-search">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input placeholder="Buscar por nome de campanha..." />
        <button class="btn btn-sm btn-outline-secondary btn-pill">Buscar</button>
        <a href="#" class="btn btn-sm btn-primary btn-pill ml-auto"><i class="fa-regular fa-paper-plane mr-1"></i> Nova campanha</a>
      </div>
    </section>

  <!-- BOTÃO EXEMPLO -->
<button class="btn btn-primary btn-pill" data-toggle="modal" data-target="#md-anamnese">
  Preencher anamnese
</button>

<!-- MODAL: ANAMNESE -->
<div class="modal fade" id="md-anamnese" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-xl">
    <div class="modal-content anm-modal">
      <div class="modal-header themed">
        <div class="d-flex align-items-center">
          <h5 class="modal-title mb-0">
            <i class="fa-regular fa-clipboard mr-2"></i>Ficha de Anamnese
          </h5>
          <div class="ml-3 small muted">Passo <span id="anm-step">1</span>/<span id="anm-total">6</span></div>
        </div>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>

      <div class="anm-progress">
        <div class="anm-progress-bar" id="anm-progress"></div>
      </div>

      <form id="form-anamnese">
        <div class="modal-body">
          <div class="anm-viewport">
            <!-- ========== PASSO 1: DADOS PESSOAIS ========== -->
            <section class="an-step active">
              <div class="crm-card">
                <h6 class="mb-3">Dados pessoais</h6>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Nome completo *</label>
                    <input class="form-control" name="nome" required />
                  </div>
                  <div class="form-group col-md-3">
                    <label>Data de nascimento *</label>
                    <input type="date" class="form-control" name="nascimento" required />
                  </div>
                  <div class="form-group col-md-3">
                    <label>Sexo</label>
                    <select class="form-control" name="sexo">
                      <option>F</option><option>M</option><option>Outro</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-8">
                    <label>Endereço</label>
                    <input class="form-control" name="endereco"/>
                  </div>
                  <div class="form-group col-md-4">
                    <label>Telefone</label>
                    <input class="form-control" name="telefone" placeholder="(11) 9 9999-9999"/>
                  </div>
                </div>
              </div>
            </section>

            <!-- ========== PASSO 2: QUEIXA PRINCIPAL ========== -->
            <section class="an-step">
              <div class="crm-card">
                <h6 class="mb-3">Queixa principal</h6>
                <textarea class="form-control" rows="5" name="queixa" placeholder="Descreva o motivo da consulta..."></textarea>
              </div>
            </section>

            <!-- ========== PASSO 3: SAÚDE GERAL ========== -->
            <section class="an-step">
              <div class="crm-card">
                <h6 class="mb-3">Saúde geral</h6>

                <div class="q">
                  <label class="d-block">Está em tratamento médico?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="tratamento_medico" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="tratamento_medico" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="tratamento_medico_qual" placeholder="Qual?"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui diabetes?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="diabetes" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="diabetes" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="diabetes_qual" placeholder="Tipo / observações"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui algum distúrbio sanguíneo?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="disturbio_sanguineo" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="disturbio_sanguineo" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="disturbio_sanguineo_qual" placeholder="Qual?"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui alguma doença cardiovascular?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="cardio" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="cardio" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="cardio_qual" placeholder="Qual?"></div>
                </div>
              </div>
            </section>

            <!-- ========== PASSO 4: HISTÓRICO MÉDICO ========== -->
            <section class="an-step">
              <div class="crm-card">
                <h6 class="mb-3">Histórico médico</h6>

                <div class="q">
                  <label class="d-block">Já teve hepatite?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="hepatite" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="hepatite" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="hepatite_qual" placeholder="Tipo/ano"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui alguma alergia?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="alergia" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="alergia" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="alergia_qual" placeholder="Medicamentos, alimentos, etc."></div>
                </div>

                <div class="q">
                  <label class="d-block">Já teve reação à anestesia local?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="reacao_anestesia" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="reacao_anestesia" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="reacao_anestesia_qual" placeholder="Descreva"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui alguma doença respiratória?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="respiratoria" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="respiratoria" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="respiratoria_qual" placeholder="Qual?"></div>
                </div>

                <div class="q">
                  <label class="d-block">Possui DST ou HIV?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="dst_hiv" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="dst_hiv" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="dst_hiv_qual" placeholder="Detalhes"></div>
                </div>
              </div>
            </section>

            <!-- ========== PASSO 5: HÁBITOS E SINAIS ========== -->
            <section class="an-step">
              <div class="crm-card">
                <h6 class="mb-3">Hábitos e sinais</h6>

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Pressão arterial</label>
                    <select class="form-control" name="pressao">
                      <option>Normal</option>
                      <option>Alta</option>
                      <option>Baixa</option>
                    </select>
                  </div>
                  <div class="form-group col-md-6">
                    <label>Se souber, informe o valor</label>
                    <input class="form-control" name="pressao_valor" placeholder="Ex.: 12/8"/>
                  </div>
                </div>

                <div class="q">
                  <label class="d-block">Está usando algum medicamento atualmente?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="medicamento" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="medicamento" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="medicamento_qual" placeholder="Qual?"></div>
                </div>

                <div class="q">
                  <label class="d-block">Sangramento gengival com facilidade?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="sangra" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="sangra" value="Sim"> Sim</label>
                  </div>
                </div>

                <div class="q">
                  <label class="d-block">Sente dor ao mastigar com frequência?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="dor_mastigar" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="dor_mastigar" value="Sim"> Sim</label>
                  </div>
                </div>
              </div>
            </section>

            <!-- ========== PASSO 6: ODONTOLÓGICO + CONSENTIMENTO ========== -->
            <section class="an-step">
              <div class="crm-card">
                <h6 class="mb-3">Histórico odontológico</h6>

                <div class="q">
                  <label class="d-block">Tem medo de dentista?</label>
                  <div class="yn">
                    <label class="yn-opt"><input type="radio" name="medo_dentista" value="Não" checked> Não</label>
                    <label class="yn-opt"><input type="radio" name="medo_dentista" value="Sim"> Sim</label>
                  </div>
                  <div class="if-yes"><input class="form-control" name="medo_motivo" placeholder="O que te deixa desconfortável?"></div>
                </div>

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Qual foi a última visita ao dentista?</label>
                    <input class="form-control" name="ultima_visita" placeholder="Ex.: há 6 meses"/>
                  </div>
                  <div class="form-group col-md-6">
                    <label>Motivo da visita de hoje</label>
                    <input class="form-control" name="motivo_visita"/>
                  </div>
                </div>

                <hr>
                <div class="form-group">
                  <label class="d-block font-weight-bold">Declaração</label>
                  <div class="small muted mb-2">
                    Declaro que as informações prestadas são verdadeiras e autorizo o uso dos dados para fins clínicos.
                  </div>
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="consent" required>
                    <label class="custom-control-label" for="consent">Li e concordo com a declaração.</label>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Assinatura (digite seu nome completo)</label>
                    <input class="form-control" name="assinatura" required>
                  </div>
                  <div class="form-group col-md-6">
                    <label>Data</label>
                    <input type="date" class="form-control" name="data_assinatura" required>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary btn-pill" id="anm-prev">Anterior</button>
          <button type="button" class="btn btn-primary btn-pill" id="anm-next">Próximo</button>
          <button type="submit" class="btn btn-primary btn-pill d-none" id="anm-submit">
            Enviar anamnese
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    

  </main>
</div>

<script>
(function(){
  const form = document.getElementById('form-anamnese');
  const steps = Array.from(document.querySelectorAll('.an-step'));
  const prevBtn = document.getElementById('anm-prev');
  const nextBtn = document.getElementById('anm-next');
  const submitBtn = document.getElementById('anm-submit');
  const progress = document.getElementById('anm-progress');
  const stepLbl = document.getElementById('anm-step');
  const totalLbl = document.getElementById('anm-total');
  const DRAFT_KEY = 'anamnese_draft_v1';

  let idx = 0;
  totalLbl.textContent = steps.length;

  function show(i){
    idx = Math.max(0, Math.min(i, steps.length-1));
    steps.forEach((s, k)=> s.classList.toggle('active', k===idx));
    stepLbl.textContent = idx+1;
    progress.style.width = ((idx)/(steps.length-1))*100 + '%';

    prevBtn.disabled = (idx===0);
    if (idx === steps.length-1){
      nextBtn.classList.add('d-none');
      submitBtn.classList.remove('d-none');
    } else {
      nextBtn.classList.remove('d-none');
      submitBtn.classList.add('d-none');
    }
  }

  function validateStep(){
    // valida apenas campos required visíveis na etapa atual
    const cur = steps[idx];
    const reqs = Array.from(cur.querySelectorAll('[required]'));
    return reqs.every(el=> !!el.value || (el.type==='checkbox' && el.checked));
  }

  function goNext(){
    if (!validateStep()){
      // foca no primeiro required vazio
      const cur = steps[idx];
      const first = cur.querySelector('[required]:invalid, [required]:not([value])');
      (first || cur.querySelector('[required]'))?.focus();
      cur.querySelectorAll('[required]').forEach(el=>el.classList.add('is-invalid'));
      return;
    }
    saveDraft();
    show(idx+1);
  }
  function goPrev(){ show(idx-1); }

  // autosave
  function saveDraft(){
    const data = Object.fromEntries(new FormData(form).entries());
    localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
  }
  function restoreDraft(){
    try{
      const data = JSON.parse(localStorage.getItem(DRAFT_KEY)||'{}');
      Object.entries(data).forEach(([k,v])=>{
        const el = form.elements[k];
        if (!el) return;
        if (el.type === 'radio'){ 
          const r = form.querySelector(`[name="${k}"][value="${v}"]`);
          r && (r.checked = true);
        }else{
          el.value = v;
        }
      });
    }catch{}
  }

  // toggles condicionais: garantimos "Não" como default
  form.addEventListener('change', e=>{
    if (e.target.matches('.yn-opt input') || e.target.matches('[required]')){
      e.target.classList.remove('is-invalid');
    }
  });

  // navegação
  nextBtn.addEventListener('click', goNext);
  prevBtn.addEventListener('click', goPrev);
  form.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      (idx === steps.length-1) ? form.requestSubmit() : goNext();
    }
  });

  // envio
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if (!validateStep()) return;

    const payload = Object.fromEntries(new FormData(form).entries());
    console.log('ANAMNESE JSON =>', payload);

    // Se você tiver o helper api() do seu crm-api.js, descomente:
    // try {
    //   await api('/anamneses', { method:'POST', body: payload });
    //   localStorage.removeItem(DRAFT_KEY);
    //   $('#md-anamnese').modal('hide');
    //   alert('Anamnese enviada ✅');
    // } catch(err){
    //   alert('Falha ao enviar: ' + (err.message||''));
    // }

    // Demo:
    localStorage.removeItem(DRAFT_KEY);
    $('#md-anamnese').modal('hide');
    alert('Anamnese (demo) gerada no console ✅');
  });

  // ao abrir o modal, restaura
  $('#md-anamnese').on('shown.bs.modal', ()=>{
    restoreDraft();
    show(0);
  });

  // ao fechar, salva e reseta validações visuais
  $('#md-anamnese').on('hide.bs.modal', ()=>{
    saveDraft();
    form.querySelectorAll('.is-invalid').forEach(el=>el.classList.remove('is-invalid'));
  });
})();
</script>

<script src="../js/jquery-3.4.1.min.js"></script><script src="../js/bootstrap.js"></script><script src="assets/crm.js"></script>
</body></html>


